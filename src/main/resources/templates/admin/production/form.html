<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Filmeo</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
        />
    </head>
    <body>
        <!-- Navbar -->
        <div th:replace="~{_partials/nav :: navbar}"></div>

        <!-- Main content -->
        <main class="container mt-4">
            <div class="row">
                <div class="col-md-8 offset-md-2">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            <h4 class="mb-0" th:if="${production.id == null}">
                                <i class="fas fa-plus-circle"></i> Add Production
                            </h4>
                            <h4 class="mb-0" th:unless="${production.id == null}">
                                <i class="fas fa-edit"></i> Edit Production
                            </h4>
                        </div>
                        <div class="card-body">
                            <form
                                th:object="${production}"
                                th:action="@{/admin/productions/add}"
                                method="post"
                                class="needs-validation"
                                novalidate
                            >
                                <input type="hidden" th:field="*{id}" />

                                <!-- Type (Movie or Series) -->
                                <div class="mb-3">
                                    <label for="type" class="form-label">
                                        Type <span class="text-danger">*</span>
                                    </label>
                                    <select
                                        class="form-select"
                                        id="type"
                                        th:field="*{type}"
                                        required
                                        onchange="toggleSeriesFields()"
                                    >
                                        <option value="">-- Select Type --</option>
                                        <option value="movie">Movie</option>
                                        <option value="series">Series</option>
                                    </select>
                                </div>

                                <!-- Title -->
                                <div class="mb-3">
                                    <label for="title" class="form-label">
                                        Title <span class="text-danger">*</span>
                                    </label>
                                    <input
                                        type="text"
                                        class="form-control"
                                        id="title"
                                        th:field="*{title}"
                                        placeholder="Enter title"
                                        required
                                    />
                                </div>

                                <!-- Poster URL -->
                                <div class="mb-3">
                                    <label for="posterUrl" class="form-label">Poster URL</label>
                                    <input
                                        type="url"
                                        class="form-control"
                                        id="posterUrl"
                                        th:field="*{posterUrl}"
                                        placeholder="https://example.com/poster.jpg"
                                    />
                                </div>

                                <!-- Director -->
                                <div class="mb-3">
                                    <label for="director" class="form-label">Director</label>
                                    <select
                                        class="form-select"
                                        id="director"
                                        th:field="*{director.id}"
                                    >
                                        <option value="">-- Select Director --</option>
                                        <option
                                            th:each="artist : ${artists}"
                                            th:value="${artist.id}"
                                            th:text="${artist.firstname + ' ' + artist.lastname}"
                                        ></option>
                                    </select>
                                </div>

                                <!-- Producing Country -->
                                <div class="mb-3">
                                    <label for="producingCountry" class="form-label">Country</label>
                                    <select
                                        class="form-select"
                                        id="producingCountry"
                                        th:field="*{producingCountry.id}"
                                    >
                                        <option value="">-- Select Country --</option>
                                        <option
                                            th:each="country : ${countries}"
                                            th:value="${country.id}"
                                            th:text="${country.name}"
                                        ></option>
                                    </select>
                                </div>

                                <!-- SERIES FIELDS (hidden by default) -->
                                <div id="seriesFields" style="display: none;">
                                    <h5 class="mt-4 mb-3 text-primary">
                                        <i class="fas fa-tv"></i> Series Details
                                    </h5>

                                    <!-- Seasons -->
                                    <div class="mb-3">
                                        <label for="season" class="form-label">Number of Seasons</label>
                                        <input
                                            type="number"
                                            class="form-control"
                                            id="season"
                                            th:field="*{seriesDetails.season}"
                                            placeholder="e.g., 5"
                                            min="1"
                                        />
                                    </div>

                                    <!-- Episodes -->
                                    <div class="mb-3">
                                        <label for="episode" class="form-label">Total Episodes</label>
                                        <input
                                            type="number"
                                            class="form-control"
                                            id="episode"
                                            th:field="*{seriesDetails.episode}"
                                            placeholder="e.g., 62"
                                            min="1"
                                        />
                                    </div>

                                    <!-- Status -->
                                    <div class="mb-3">
                                        <label for="status" class="form-label">Status</label>
                                        <select
                                            class="form-select"
                                            id="status"
                                            th:field="*{seriesDetails.status}"
                                        >
                                            <option value="">-- Select Status --</option>
                                            <option value="ongoing">Ongoing</option>
                                            <option value="finished">Finished</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Form Actions -->
                                <div class="d-flex gap-2 mt-4">
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save"></i> Save Production
                                    </button>
                                    <a href="/admin/productions" class="btn btn-secondary">
                                        <i class="fas fa-times"></i> Cancel
                                    </a>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <div th:replace="~{_partials/footer :: footer}"></div>

        <!-- Bootstrap JS Bundle -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        
        <!-- Custom Script -->
        <script>
            function toggleSeriesFields() {
                const type = document.getElementById('type').value;
                const seriesFields = document.getElementById('seriesFields');
                
                if (type === 'series') {
                    seriesFields.style.display = 'block';
                } else {
                    seriesFields.style.display = 'none';
                }
            }
            
            // Execute on page load (for edit mode)
            document.addEventListener('DOMContentLoaded', function() {
                toggleSeriesFields();
            });
        </script>
    </body>
</html>